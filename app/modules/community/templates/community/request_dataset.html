{% extends "base_template.html" %}
{% block content %}

<div class="container mt-4">

    <h2 class="fw-bold mb-2">Proponer dataset a "{{ community.name }}"</h2>
    <p class="text-muted mb-4">Selecciona uno de tus datasets disponibles y a√±ade un mensaje opcional.</p>

    <div class="list-group mb-4">
        {% for ds in datasets %}
            <button class="list-group-item list-group-item-action"
                    onclick="selectDataset('{{ ds.id }}', '{{ ds.name()|escape }}')">
                <div class="fw-semibold">{{ ds.name() }}</div>
                <small class="text-muted">ID: {{ ds.id }}</small>
            </button>
        {% endfor %}
    </div>

    <div class="card shadow-sm d-none" id="proposalFormCard">
        <div class="card-body">

            <h5 class="fw-semibold mb-3">Confirmar propuesta</h5>

            <form method="POST" action="">
                {{ form.hidden_tag() }}

                {{ form.dataset_id() }}

                <p class="mb-3">
                    <strong>Dataset seleccionado: </strong>
                    <span id="selectedDatasetName" class="text-primary"></span>
                </p>

                <div class="mb-3">
                    {{ form.message.label(class="form-label fw-semibold") }}
                    {{ form.message(class="form-control", rows=4) }}
                </div>

                {{ form.submit(class="btn btn-primary w-100") }}
            </form>

        </div>
    </div>

</div>

<script>
function selectDataset(id, name) {
    document.getElementById("proposalFormCard").classList.remove("d-none");

    document.querySelector("input[name='dataset_id']").value = id;

    document.getElementById("selectedDatasetName").textContent = name;
}
</script>

{% endblock %}
